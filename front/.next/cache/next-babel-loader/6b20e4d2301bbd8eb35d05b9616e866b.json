{"ast":null,"code":"var _this = this,\n  _jsxFileName = \"C:\\\\Dev\\\\next_react_node\\\\front\\\\pages\\\\index.js\",\n  _s = $RefreshSig$();\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { message } from 'antd';\nimport AppLayout from '../components/AppLayout';\nimport PostForm from '../components/PostForm';\nimport PostCard from '../components/PostCard';\nimport { LOAD_POSTS_REQUEST } from '../reducers/post';\nvar Home = function Home() {\n  _s();\n  var dispatch = useDispatch();\n  var me = useSelector(function (state) {\n    return state.user.me;\n  });\n  var mainPosts = useSelector(function (state) {\n    return state.post.mainPosts;\n  });\n  var _useSelector = useSelector(function (state) {\n      return state.post;\n    }),\n    hasMorePost = _useSelector.hasMorePost,\n    loadPostsLoading = _useSelector.loadPostsLoading,\n    retweetError = _useSelector.retweetError;\n  var _useSelector2 = useSelector(function (state) {\n      return state.post;\n    }),\n    reportPostDone = _useSelector2.reportPostDone,\n    reportPostError = _useSelector2.reportPostError;\n  useEffect(function () {\n    if (reportPostDone) {\n      message.success('신고가 접수되었습니다. 빠른 시일 내에 조치하겠습니다.', 5);\n    }\n    if (reportPostError) {\n      message.error(reportPostError, 5);\n    }\n  }, [reportPostDone, reportPostError]);\n  useEffect(function () {\n    if (retweetError) {\n      alert(retweetError);\n    }\n  }, [retweetError]);\n  useEffect(function () {\n    function onScroll() {\n      if (window.pageYOffset + document.documentElement.clientHeight > document.documentElement.scrollHeight - 300) {\n        if (hasMorePost && !loadPostsLoading) {\n          var _mainPosts;\n          var lastId = (_mainPosts = mainPosts[mainPosts.length - 1]) === null || _mainPosts === void 0 ? void 0 : _mainPosts.id;\n          dispatch({\n            type: LOAD_POSTS_REQUEST,\n            lastId: lastId\n          });\n        }\n      }\n    }\n    window.addEventListener('scroll', onScroll);\n    return function () {\n      window.removeEventListener('scroll', onScroll);\n    };\n  }, [hasMorePost, loadPostsLoading, mainPosts]);\n  return __jsx(AppLayout, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 5\n    }\n  }, me && __jsx(PostForm, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 14\n    }\n  }), mainPosts.map(function (post) {\n    return __jsx(PostCard, {\n      key: post.id,\n      post: post,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 56,\n        columnNumber: 32\n      }\n    });\n  }));\n};\n_s(Home, \"uu0W3HSkGhsZ4/TKObF3n48K5y4=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector, useSelector];\n});\n_c = Home;\nexport var __N_SSP = true;\nexport default Home;\nvar _c;\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"names":["React","useEffect","useSelector","useDispatch","message","AppLayout","PostForm","PostCard","LOAD_POSTS_REQUEST","Home","dispatch","me","state","user","mainPosts","post","hasMorePost","loadPostsLoading","retweetError","reportPostDone","reportPostError","success","error","alert","onScroll","window","pageYOffset","document","documentElement","clientHeight","scrollHeight","lastId","length","id","type","addEventListener","removeEventListener","map"],"sources":["C:/Dev/next_react_node/front/pages/index.js"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { END } from 'redux-saga';\r\nimport axios from 'axios';\r\nimport { message } from 'antd';\r\n\r\nimport AppLayout from '../components/AppLayout';\r\nimport PostForm from '../components/PostForm';\r\nimport PostCard from '../components/PostCard';\r\nimport { LOAD_POSTS_REQUEST } from '../reducers/post';\r\nimport { LOAD_MY_INFO_REQUEST } from '../reducers/user';\r\nimport wrapper from '../store/configureStore';\r\n\r\nconst Home = () => {\r\n  const dispatch = useDispatch();\r\n  const me = useSelector((state) => state.user.me);\r\n  const mainPosts = useSelector((state) => state.post.mainPosts);\r\n  const { hasMorePost, loadPostsLoading, retweetError } = useSelector((state) => state.post);\r\n  const { reportPostDone, reportPostError } = useSelector((state) => state.post);\r\n\r\n  useEffect(() => {\r\n    if (reportPostDone) {\r\n      message.success('신고가 접수되었습니다. 빠른 시일 내에 조치하겠습니다.', 5);\r\n    }\r\n    if (reportPostError) {\r\n      message.error(reportPostError, 5);\r\n    }\r\n  }, [reportPostDone, reportPostError]);\r\n\r\n  useEffect(() => {\r\n    if (retweetError) {\r\n      alert(retweetError);\r\n    }\r\n  }, [retweetError]);\r\n\r\n  useEffect(() => {\r\n    function onScroll() {\r\n      if (window.pageYOffset + document.documentElement.clientHeight > document.documentElement.scrollHeight - 300) {\r\n        if (hasMorePost && !loadPostsLoading) {\r\n          const lastId = mainPosts[mainPosts.length - 1]?.id;\r\n          dispatch({\r\n            type: LOAD_POSTS_REQUEST,\r\n            lastId,\r\n          });\r\n        }\r\n      }\r\n    }\r\n    window.addEventListener('scroll', onScroll);\r\n    return () => {\r\n      window.removeEventListener('scroll', onScroll);\r\n    };\r\n  }, [hasMorePost, loadPostsLoading, mainPosts]);\r\n  return (\r\n    <AppLayout>\r\n      {me && <PostForm />}\r\n      {mainPosts.map((post) => <PostCard key={post.id} post={post} />)}\r\n    </AppLayout>\r\n  );\r\n};\r\n\r\nexport const getServerSideProps = wrapper.getServerSideProps(async (context) => {\r\n  const cookie = context.req ? context.req.headers.cookie : '';\r\n  axios.defaults.headers.Cookie = '';\r\n  if (context.req && cookie) {\r\n    axios.defaults.headers.Cookie = cookie;\r\n  }\r\n  context.store.dispatch({\r\n    type: LOAD_MY_INFO_REQUEST,\r\n  });\r\n  context.store.dispatch({\r\n    type: LOAD_POSTS_REQUEST,\r\n  });\r\n  context.store.dispatch(END);\r\n  await context.store.sagaTask.toPromise();\r\n});\r\n\r\nexport default Home;"],"mappings":"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"},"metadata":{},"sourceType":"module"}